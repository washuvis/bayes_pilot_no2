<div id="debrief">

<p>
<strong>Please copy and paste the following code back on Mechanical Turk before closing this window:</strong>
</p>
<h2 id="postId"></h2>

<p>
<strong> Thank you for your participation. Feel free to submit any additional comments below.
</strong>
</p>

<textarea name="textarea" rows="10" cols="50">Leave feedback here</textarea>
<br>
<button id="submitComments" type="button">Submit</button>
<br>
<div id="submitFeedback"></div>

</div>

<style>
</style>
<script> 
(function() {
  var postId  = experimentr.postId
  	, payment = (experimentr.getBonus())
    , data    = {};

  console.log(experimentr.data);

  d3.select("#postId").text(postId);
  // d3.select("#payment").html(payment.toFloat()+1);
  var comments = d3.select('#debrief').select('textarea')
    .on('keypress', function() { d3.select('#submitComments').attr('disabled', null); })
    .on('blur', function() { d3.select('#submitComments').attr('disabled', null); });
  
  d3.select('#submitComments')
    .on('click', function () { 
    	data.comments = comments.property('value'); 
    	validate(); });
  function validate() {
    if( data.comments ) { 
      console.log("DATA IS ",experimentr.getData())
      experimentr.addData(data);
      d3.select('#submitComments').style('visibility', 'hidden');
      d3.select('#debrief').select('textarea').style('visibility', 'hidden');
      d3.select('#submitFeedback').text('Submit Successful');
    }
    else{
      d3.select('#submitComments').style('visibility', 'hidden');
      d3.select('#debrief').select('textarea').style('visibility', 'hidden');
      d3.select('#submitFeedback').text('Submit Successful');      
    }
  }
}());
</script>

